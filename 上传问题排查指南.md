# ä¸Šä¼ é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ” é—®é¢˜ï¼šå½•éŸ³å®Œæˆååªæœ‰æœ¬åœ°ä¸‹è½½ï¼ŒCOS ä¸­æ²¡æœ‰æ–‡ä»¶

### å¯èƒ½çš„åŸå› ï¼š

1. **é’±åŒ…æœªè¿æ¥** - ä¸Šä¼ åŠŸèƒ½éœ€è¦é’±åŒ…è¿æ¥
2. **ç¯å¢ƒå˜é‡æœªæ­£ç¡®åŠ è½½** - åç«¯æ— æ³•è®¿é—® COS
3. **ä¸Šä¼ è¿‡ç¨‹ä¸­æœ‰é”™è¯¯** - é”™è¯¯è¢«é™é»˜æ•è·
4. **ç½‘ç»œæˆ–æƒé™é—®é¢˜** - COS ä¸Šä¼ å¤±è´¥

---

## ğŸ“‹ æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€

**åœ¨æµè§ˆå™¨ä¸­ï¼š**

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹ Console æ ‡ç­¾é¡µ
3. ç‚¹å‡»"æäº¤å½•éŸ³"æŒ‰é’®
4. æŸ¥çœ‹æ˜¯å¦æœ‰ä»¥ä¸‹æ—¥å¿—ï¼š
   - `æ‰€æœ‰å½•éŸ³å®Œæˆï¼Œå¼€å§‹æœ€ç»ˆæäº¤`
   - `æ­£åœ¨ä¸Šä¼ åˆ°äº‘ç«¯...`
   - `å½•éŸ³ sentence_X ä¸Šä¼ æˆåŠŸ: xxx`

**å¦‚æœæ²¡æœ‰çœ‹åˆ°ä¸Šä¼ ç›¸å…³æ—¥å¿—ï¼š**
- æ£€æŸ¥å³ä¸Šè§’é’±åŒ…æŒ‰é’®æ˜¯å¦æ˜¾ç¤ºå·²è¿æ¥
- å¦‚æœæ˜¾ç¤º"è¿æ¥é’±åŒ…"ï¼Œè¯´æ˜é’±åŒ…æœªè¿æ¥
- **è§£å†³æ–¹æ³•**ï¼šç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®è¿æ¥ MetaMask

---

### æ­¥éª¤ 2ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡

**åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç»ˆç«¯ï¼‰ï¼š**

1. ç¡®è®¤ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
2. ç¡®è®¤æ–‡ä»¶å†…å®¹æ ¼å¼æ­£ç¡®ï¼š
   ```bash
   COS_SECRET_ID=ä½ çš„å®é™…SecretId
   COS_SECRET_KEY=...ï¼ˆå®é™…å€¼ï¼‰
   COS_BUCKET=xxx-1250000000ï¼ˆå®é™…å€¼ï¼‰
   COS_REGION=ap-beijingï¼ˆå®é™…å€¼ï¼‰
   ```

3. **é‡å¯å¼€å‘æœåŠ¡å™¨**ï¼š
   ```bash
   # åœæ­¢æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
   # é‡æ–°å¯åŠ¨
   npm run dev
   ```

---

### æ­¥éª¤ 3ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

**åœ¨æµè§ˆå™¨ä¸­ï¼š**

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾é¡µ
3. æ¸…ç©ºæ§åˆ¶å°ï¼ˆç‚¹å‡»æ¸…é™¤æŒ‰é’®ï¼‰
4. ç‚¹å‡»"æäº¤å½•éŸ³"æŒ‰é’®
5. æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯

**å¸¸è§é”™è¯¯ï¼š**

- `ä¸Šä¼ å¤±è´¥: xxx` - æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
- `Cannot find module` - ä¾èµ–æœªå®‰è£…
- `COS_SECRET_ID is not defined` - ç¯å¢ƒå˜é‡æœªåŠ è½½
- `Network Error` - ç½‘ç»œé—®é¢˜æˆ– API è·¯ç”±é”™è¯¯

---

### æ­¥éª¤ 4ï¼šæ£€æŸ¥ç½‘ç»œè¯·æ±‚

**åœ¨æµè§ˆå™¨ä¸­ï¼š**

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾é¡µ
3. ç‚¹å‡»"æäº¤å½•éŸ³"æŒ‰é’®
4. æŸ¥æ‰¾ä»¥ä¸‹è¯·æ±‚ï¼š
   - `POST /api/upload` - ä¸Šä¼ è¯·æ±‚
   - æŸ¥çœ‹è¯·æ±‚çŠ¶æ€ç ï¼š
     - `200` - æˆåŠŸ
     - `400` - è¯·æ±‚é”™è¯¯ï¼ˆæ£€æŸ¥å‚æ•°ï¼‰
     - `500` - æœåŠ¡å™¨é”™è¯¯ï¼ˆæ£€æŸ¥ç¯å¢ƒå˜é‡å’Œä»£ç ï¼‰

5. ç‚¹å‡»è¯·æ±‚æŸ¥çœ‹è¯¦æƒ…ï¼š
   - **Request** - æŸ¥çœ‹å‘é€çš„æ•°æ®
   - **Response** - æŸ¥çœ‹æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯

---

### æ­¥éª¤ 5ï¼šæ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

**åœ¨ç»ˆç«¯ï¼ˆè¿è¡Œ npm run dev çš„çª—å£ï¼‰ï¼š**

æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ï¼š
- `COS ä¸Šä¼ å¤±è´¥: xxx` - COS ç›¸å…³é”™è¯¯
- `ä¸Šä¼ é”™è¯¯: xxx` - å…¶ä»–é”™è¯¯

**å¸¸è§é”™è¯¯ï¼š**

1. **SecretId æˆ– SecretKey é”™è¯¯**
   ```
   Error: InvalidAccessKeyId
   ```
   è§£å†³ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡ä¸­çš„å¯†é’¥æ˜¯å¦æ­£ç¡®

2. **å­˜å‚¨æ¡¶ä¸å­˜åœ¨æˆ–åç§°é”™è¯¯**
   ```
   Error: NoSuchBucket
   ```
   è§£å†³ï¼šæ£€æŸ¥ COS_BUCKET æ˜¯å¦æ­£ç¡®

3. **åœ°åŸŸé”™è¯¯**
   ```
   Error: InvalidRegion
   ```
   è§£å†³ï¼šæ£€æŸ¥ COS_REGION æ˜¯å¦æ­£ç¡®

4. **æƒé™ä¸è¶³**
   ```
   Error: AccessDenied
   ```
   è§£å†³ï¼šæ£€æŸ¥ API å¯†é’¥æ˜¯å¦æœ‰ COS ä¸Šä¼ æƒé™

---

## ğŸ› ï¸ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šç¡®ä¿é’±åŒ…å·²è¿æ¥

1. ç‚¹å‡»å³ä¸Šè§’"è¿æ¥é’±åŒ…"æŒ‰é’®
2. åœ¨ MetaMask ä¸­ç¡®è®¤è¿æ¥
3. ç¡®è®¤é’±åŒ…åœ°å€æ˜¾ç¤ºåœ¨å³ä¸Šè§’
4. é‡æ–°å½•åˆ¶å¹¶æäº¤

### æ–¹æ¡ˆ 2ï¼šæ£€æŸ¥å¹¶é‡å¯æœåŠ¡å™¨

1. ç¡®è®¤ `.env` æ–‡ä»¶å­˜åœ¨ä¸”å†…å®¹æ­£ç¡®
2. åœæ­¢å¼€å‘æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
3. é‡æ–°å¯åŠ¨ï¼š`npm run dev`
4. é‡æ–°æµ‹è¯•ä¸Šä¼ 

### æ–¹æ¡ˆ 3ï¼šæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹ä»£ç ï¼ŒæŸ¥çœ‹ä¸Šä¼ å†å²ï¼š

```javascript
// æŸ¥çœ‹ä¸Šä¼ å†å²
const history = JSON.parse(localStorage.getItem('uploadHistory') || '[]');
console.log('ä¸Šä¼ å†å²:', history);

// æŸ¥çœ‹æœ€åä¸€æ¬¡ä¸Šä¼ ç»“æœ
if (history.length > 0) {
  console.log('æœ€åä¸€æ¬¡ä¸Šä¼ :', history[history.length - 1]);
}
```

---

## âœ… éªŒè¯ä¸Šä¼ æˆåŠŸçš„æ ‡å¿—

å¦‚æœä¸Šä¼ æˆåŠŸï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°ï¼š**
   ```
   å½•éŸ³ sentence_1 ä¸Šä¼ æˆåŠŸ: recordings/0x.../xxx.wav
   æ‰€æœ‰å½•éŸ³ä¸Šä¼ å®Œæˆ: { success: 5, error: 0, ... }
   ```

2. **æŒ‰é’®æ–‡å­—å˜åŒ–ï¼š**
   - "æ­£åœ¨ä¸Šä¼ åˆ°äº‘ç«¯..."
   - "ä¸Šä¼ å®Œæˆï¼æˆåŠŸ 5 ä¸ª"

3. **æç¤ºä¿¡æ¯ï¼š**
   ```
   æœ¬åœ°ä¸‹è½½å®Œæˆï¼æˆåŠŸä¸‹è½½ 5 ä¸ªæ–‡ä»¶
   äº‘ç«¯ä¸Šä¼ å®Œæˆï¼æˆåŠŸä¸Šä¼  5 ä¸ªæ–‡ä»¶
   ```

4. **è…¾è®¯äº‘æ§åˆ¶å°ï¼š**
   - ç™»å½• https://console.cloud.tencent.com/cos
   - è¿›å…¥å­˜å‚¨æ¡¶
   - æŸ¥çœ‹ `recordings/ä½ çš„é’±åŒ…åœ°å€/` ç›®å½•
   - åº”è¯¥èƒ½çœ‹åˆ° WAV æ–‡ä»¶

---

## ğŸš¨ å¦‚æœä»ç„¶æ— æ³•ä¸Šä¼ 

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥æ’æŸ¥ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯**ï¼ˆæˆªå›¾æˆ–å¤åˆ¶ï¼‰
2. **Network æ ‡ç­¾é¡µçš„è¯·æ±‚è¯¦æƒ…**ï¼ˆç‰¹åˆ«æ˜¯ `/api/upload` è¯·æ±‚ï¼‰
3. **æœåŠ¡å™¨ç»ˆç«¯çš„é”™è¯¯ä¿¡æ¯**ï¼ˆå¦‚æœæœ‰ï¼‰
4. **é’±åŒ…è¿æ¥çŠ¶æ€**ï¼ˆæ˜¯å¦å·²è¿æ¥ï¼‰
5. **ç¯å¢ƒå˜é‡é…ç½®**ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯åï¼‰

---

## ğŸ“ ä¸´æ—¶è°ƒè¯•ä»£ç 

å¦‚æœé—®é¢˜æŒç»­ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹ä»£ç æ¥æµ‹è¯•ä¸Šä¼ ï¼š

```javascript
// æµ‹è¯•ä¸Šä¼ åŠŸèƒ½
async function testUpload() {
  // 1. æ£€æŸ¥é’±åŒ…è¿æ¥
  const walletAddress = '0xä½ çš„é’±åŒ…åœ°å€'; // æ›¿æ¢ä¸ºå®é™…åœ°å€
  
  // 2. åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶
  const testBlob = new Blob(['test'], { type: 'audio/wav' });
  
  // 3. å°è¯•ä¸Šä¼ 
  try {
    const formData = new FormData();
    formData.append('file', testBlob, 'test.wav');
    formData.append('walletAddress', walletAddress);
    formData.append('sentenceText', 'æµ‹è¯•å¥å­');
    formData.append('sentenceId', 'test_1');
    
    const response = await fetch('/api/upload', {
      method: 'POST',
      body: formData,
    });
    
    const result = await response.json();
    console.log('ä¸Šä¼ ç»“æœ:', result);
    
    if (result.success) {
      console.log('âœ… ä¸Šä¼ æˆåŠŸï¼æ–‡ä»¶è·¯å¾„:', result.objectKey);
    } else {
      console.error('âŒ ä¸Šä¼ å¤±è´¥:', result.error);
    }
  } catch (error) {
    console.error('âŒ ä¸Šä¼ å¼‚å¸¸:', error);
  }
}

// è¿è¡Œæµ‹è¯•
testUpload();
```
